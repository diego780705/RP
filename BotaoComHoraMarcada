<style>
    .total# {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: auto;
        background-color: #ffffff40 !important;
        border: 1px solid #ffffff40;
        border-radius: 20px !important;
        height: 75px;
    }

    .botao# {
        display: flex;
        margin: auto;
        flex-direction: column;
        align-items: center;
        background-color: transparent !important;
        border-radius: 20px !important;
        height: 50px;
        width: 75px;
    }

    .titulo# {
        color: #000000;
        font-size: 10px;
    }

    .icone# {
        font-size: 35px;
        text-shadow: 0px 0px 10px #BD960B;
    }

    .selecaohora# {
        display: flex;
        margin: auto;
        border-radius: 20px !important;
        background-color: #ffffff40 !important;
        font-size: 09px;
        height: 15px;
        width: 50px;
    }
</style>

<div class="total#">
    <button class="botao#">
        <div class="titulo#">Externa</div>
        <i class="icone# material-icons" style="text-shadow: 0px 0px 0px; color: #8C8C8C;">deck</i>
    </button>
    <input type="time" class="selecaohora#" />
</div>

<script>
    (function (scope) {
        function tick() {
            var status = $('.botao#').data("state");
            var hora = $('.selecaohora#').val();
            var data = new Date();
            //data.setHours(data.getHours() + 3);
            var horas = data.getHours();
            var minutos = data.getMinutes();
            var horaminuto = horas.toString().padStart(2, '0') + ':' + minutos.toString().padStart(2, '0');

            if (hora === horaminuto) {
                if (status == "OFF") {
                    ON();
                } else if (status == "ON") {
                    OFF();
                }
            } else {
                setTimeout(tick, 5000);
                document.querySelector('.icone#').innerHTML = "update";
                document.querySelector('.icone#').style.textShadow = "0px 0px 10px #D2691E";
                document.querySelector('.icone#').style.color = "#D2691E";
            }
        }

        $('.selecaohora#').on('change', function () {
            tick();
        });

        $('.botao#').on('click', function () {
            if ($('.botao#').data("state") === "ON") {
                OFF();
            } else {
                ON();
            }
        });

        scope.$watch('msg', function (msg) {
            if (msg.payload === "ON") {
                ON();
            } else if (msg.payload === "OFF") {
                OFF();
            }
        });

        function OFF() {
            if ($('.botao#').data("state") === "ON") {
                scope.send({ "payload": "OFF" });
            }
            $(".botao#").data("state", "OFF");
            document.querySelector('.icone#').style.textShadow = "0px 0px 0px";
            document.querySelector('.icone#').style.color = "#8C8C8C";
            document.querySelector('.icone#').innerHTML = "deck";
        }

        function ON() {
            if ($('.botao#').data("state") === "OFF") {
                scope.send({ "payload": "ON" });
            }
            $(".botao#").data("state", "ON");
            document.querySelector('.icone#').style.textShadow = "0px 0px 10px #BD960B";
            document.querySelector('.icone#').style.color = "#BD960B";
            document.querySelector('.icone#').innerHTML = "deck";
        }
    })(scope);
</script>
